{
	"info": {
		"_postman_id": "dementia-api-testing-v4",
		"name": "Dementia API Testing - NB-Llama + NB-Whisper Integration (v4)",
		"description": "Comprehensive testing collection for Dementia Care AI Assistant API - Full Norwegian AI Integration\n\n**Setup Instructions:**\n1. Make sure FastAPI server is running: `uvicorn app.main:app --reload --port 8000`\n2. Import this collection into Postman\n3. Run tests in order or use the Collection Runner\n\n**üá≥üá¥ Norwegian AI Features:**\n- ‚úÖ 5 NB-Whisper models (tiny/base/small/medium/large) - Speech-to-Text\n- ‚úÖ NB-Llama 3.2-1B model - Norwegian Language Generation\n- ‚úÖ Apple M2 Max MPS acceleration for both models\n- ‚úÖ Real-time SSE streaming chat compatible with ai-chat-ui\n- ‚úÖ Medical boundary enforcement for healthcare safety\n- ‚úÖ Direct processing (no Redis/Celery workers required)\n\n**üß† Dementia Care Specialization:**\n- Norwegian-optimized responses for dementia care\n- Safety boundaries preventing medical advice\n- Context-aware assistant persona\n- Real-time conversational AI\n\n**Test Coverage:**\n- Health checks for both speech and chat models\n- Speech processing with multiple NB-Whisper models\n- Chat API with SSE streaming (ai-chat-ui compatible)\n- Medical boundary enforcement testing\n- Norwegian language conversation testing\n- Performance and error handling scenarios",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8000",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "01. Health Checks",
			"item": [
				{
					"name": "Basic Health Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains status\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData.status).to.eql('healthy');",
									"});",
									"",
									"pm.test(\"NB-Whisper models are loaded\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('services');",
									"    const modelSizes = ['tiny', 'base', 'small', 'medium', 'large'];",
									"    let whisperLoaded = false;",
									"    modelSizes.forEach(size => {",
									"        const modelKey = `nb_whisper_${size}`;",
									"        if (jsonData.services[modelKey]) {",
									"            pm.expect(jsonData.services[modelKey]).to.be.oneOf(['ready', 'not_loaded']);",
									"            if (jsonData.services[modelKey] === 'ready') {",
									"                whisperLoaded = true;",
									"            }",
									"        }",
									"    });",
									"    pm.expect(whisperLoaded, 'At least one NB-Whisper model should be ready').to.be.true;",
									"});",
									"",
									"pm.test(\"NB-Llama model status check\", function () {",
									"    const jsonData = pm.response.json();",
									"    // Check NB-Llama model status (optional - may not be loaded)",
									"    if (jsonData.services.nb_llama_1b) {",
									"        pm.expect(['ready', 'not_loaded']).to.include(jsonData.services.nb_llama_1b);",
									"        if (jsonData.services.nb_llama_1b === 'ready') {",
									"            console.log('‚úÖ NB-Llama 3.2-1B model is ready for chat');",
									"        } else {",
									"            console.log('‚ö†Ô∏è NB-Llama 3.2-1B model not loaded - check authentication');",
									"        }",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"health"
							]
						},
						"description": "Test basic health endpoint and NB-Whisper model status"
					}
				},
				{
					"name": "Root Info Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains project info\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('message');",
									"    pm.expect(jsonData.message).to.include('Dementia');",
									"    pm.expect(jsonData).to.have.property('version');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								""
							]
						},
						"description": "Test root endpoint"
					}
				},
				{
					"name": "Chat Health Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Chat functionality is healthy\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData.status).to.be.oneOf(['healthy', 'degraded']);",
									"    pm.expect(jsonData).to.have.property('nb_llama_available');",
									"    pm.expect(jsonData).to.have.property('medical_boundaries');",
									"    pm.expect(jsonData.medical_boundaries).to.eql('active');",
									"    pm.expect(jsonData).to.have.property('streaming');",
									"    pm.expect(jsonData.streaming).to.eql('enabled');",
									"});",
									"",
									"pm.test(\"NB-Llama model availability\", function () {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.nb_llama_available) {",
									"        pm.expect(jsonData.status).to.eql('healthy');",
									"        console.log('‚úÖ NB-Llama model is loaded and ready');",
									"    } else {",
									"        pm.expect(jsonData.status).to.eql('degraded');",
									"        console.log('‚ö†Ô∏è NB-Llama model not available - check authentication');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/chat/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"chat",
								"health"
							]
						},
						"description": "Test chat-specific health endpoint and NB-Llama model status"
					}
				}
			],
			"description": "Basic health and connectivity tests"
		},
		{
			"name": "02. Processor Capabilities",
			"item": [
				{
					"name": "Get Processor Capabilities",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains processors\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('processors');",
									"    pm.expect(jsonData.processors).to.be.an('array');",
									"    pm.expect(jsonData).to.have.property('default_processor');",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData.status).to.eql('ready');",
									"});",
									"",
									"pm.test(\"NB-Whisper processor exists\", function () {",
									"    const jsonData = pm.response.json();",
									"    const nbWhisper = jsonData.processors.find(p => p.name.includes('nb-whisper'));",
									"    pm.expect(nbWhisper).to.exist;",
									"    pm.expect(nbWhisper).to.have.property('supported_formats');",
									"    pm.expect(nbWhisper).to.have.property('language');",
									"    pm.expect(nbWhisper.language).to.include('Norwegian');",
									"    pm.expect(nbWhisper.requires_api_key).to.be.false;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/processors/capabilities",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"processors",
								"capabilities"
							]
						},
						"description": "Get available speech processors and their capabilities"
					}
				}
			],
			"description": "Test processor discovery and capabilities"
		},
		{
			"name": "02.5 NB-Llama Chat API",
			"item": [
				{
					"name": "Norwegian Chat - General Question",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response is SSE format\", function () {",
									"    const responseText = pm.response.text();",
									"    pm.expect(responseText).to.include('data: {');",
									"    pm.expect(responseText).to.include('\"choices\"');",
									"    pm.expect(responseText).to.include('\"delta\"');",
									"    pm.expect(responseText).to.include('\"content\"');",
									"    pm.expect(responseText).to.include('data: [DONE]');",
									"});",
									"",
									"pm.test(\"Norwegian response content\", function () {",
									"    const responseText = pm.response.text();",
									"    // Extract content from SSE stream",
									"    const contentMatches = responseText.match(/\"content\":\"([^\"]*)\"/g);",
									"    if (contentMatches && contentMatches.length > 0) {",
									"        const fullResponse = contentMatches.join('').toLowerCase();",
									"        // Check for Norwegian words and dementia care context",
									"        const norwegianWords = ['hei', 'jeg', 'er', 'kan', 'hjelpe', 'demens', 'omsorg', 'assistent'];",
									"        const foundNorwegian = norwegianWords.some(word => fullResponse.includes(word));",
									"        pm.expect(foundNorwegian).to.be.true;",
									"        console.log('‚úÖ Norwegian response detected');",
									"    }",
									"});",
									"",
									"pm.test(\"ai-chat-ui compatible format\", function () {",
									"    const responseText = pm.response.text();",
									"    const lines = responseText.split('\\n');",
									"    const dataLines = lines.filter(line => line.startsWith('data: {'));",
									"    ",
									"    dataLines.forEach(line => {",
									"        const jsonStr = line.substring(6); // Remove 'data: '",
									"        const jsonData = JSON.parse(jsonStr);",
									"        pm.expect(jsonData).to.have.property('choices');",
									"        pm.expect(jsonData.choices[0]).to.have.property('delta');",
									"        pm.expect(jsonData.choices[0].delta).to.have.property('content');",
									"    });",
									"});",
									"",
									"pm.test(\"Response time reasonable for chat\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(30000); // 30 seconds max",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"messages\": [\n    {\"role\": \"user\", \"content\": \"Hei! Kan du fortelle meg om demens?\"}\n  ],\n  \"temperature\": 0.7,\n  \"max_tokens\": 100,\n  \"stream\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/chat",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"chat"
							]
						},
						"description": "Test general Norwegian question about dementia with SSE streaming"
					}
				},
				{
					"name": "Medical Boundary Enforcement",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Medical boundary triggered\", function () {",
									"    const responseText = pm.response.text();",
									"    // Should contain the safety response",
									"    pm.expect(responseText.toLowerCase()).to.include('beklager');",
									"    pm.expect(responseText.toLowerCase()).to.include('medisinske');",
									"    pm.expect(responseText.toLowerCase()).to.include('r√•d');",
									"    pm.expect(responseText.toLowerCase()).to.include('lege');",
									"    console.log('‚úÖ Medical boundary enforcement working');",
									"});",
									"",
									"pm.test(\"Safety message in Norwegian\", function () {",
									"    const responseText = pm.response.text();",
									"    // Extract content from SSE stream",
									"    const contentMatches = responseText.match(/\"content\":\"([^\"]*)\"/g);",
									"    if (contentMatches) {",
									"        const fullResponse = contentMatches.join('').toLowerCase();",
									"        pm.expect(fullResponse).to.include('grenser som ai-assistent');",
									"        pm.expect(fullResponse).to.include('helsepersonell');",
									"    }",
									"});",
									"",
									"pm.test(\"SSE format maintained during safety response\", function () {",
									"    const responseText = pm.response.text();",
									"    pm.expect(responseText).to.include('data: {');",
									"    pm.expect(responseText).to.include('data: [DONE]');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"messages\": [\n    {\"role\": \"user\", \"content\": \"Hvilke medisiner skal jeg gi morfar for demens?\"}\n  ],\n  \"temperature\": 0.7,\n  \"max_tokens\": 50,\n  \"stream\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/chat",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"chat"
							]
						},
						"description": "Test medical boundary enforcement with Norwegian medical keywords"
					}
				},
				{
					"name": "Multi-turn Conversation",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Multi-turn context handled\", function () {",
									"    const responseText = pm.response.text();",
									"    pm.expect(responseText).to.include('data: {');",
									"    pm.expect(responseText).to.include('data: [DONE]');",
									"});",
									"",
									"pm.test(\"Response acknowledges previous context\", function () {",
									"    const responseText = pm.response.text();",
									"    // Extract content and check for contextual response",
									"    const contentMatches = responseText.match(/\"content\":\"([^\"]*)\"/g);",
									"    if (contentMatches) {",
									"        const fullResponse = contentMatches.join('').toLowerCase();",
									"        // Should reference the conversation context",
									"        console.log('Multi-turn response generated');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"messages\": [\n    {\"role\": \"user\", \"content\": \"Hva er demens?\"},\n    {\"role\": \"assistant\", \"content\": \"Demens er en gruppe sykdommer som p√•virker hjernen og f√∏rer til gradvis tap av kognitive funksjoner som hukommelse, spr√•k og probleml√∏sning.\"},\n    {\"role\": \"user\", \"content\": \"Kan du fortelle meg mer om hvordan jeg kan hjelpe en person med demens?\"}\n  ],\n  \"temperature\": 0.7,\n  \"max_tokens\": 150,\n  \"stream\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/chat",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"chat"
							]
						},
						"description": "Test multi-turn conversation with context awareness"
					}
				},
				{
					"name": "Non-Streaming Response",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Non-streaming JSON response format\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('choices');",
									"    pm.expect(jsonData.choices[0]).to.have.property('message');",
									"    pm.expect(jsonData.choices[0].message).to.have.property('content');",
									"    pm.expect(jsonData).to.have.property('model');",
									"    pm.expect(jsonData.model).to.include('nb-llama');",
									"});",
									"",
									"pm.test(\"Norwegian content in response\", function () {",
									"    const jsonData = pm.response.json();",
									"    const content = jsonData.choices[0].message.content.toLowerCase();",
									"    const norwegianWords = ['jeg', 'er', 'kan', 'hjelpe', 'demens'];",
									"    const foundNorwegian = norwegianWords.some(word => content.includes(word));",
									"    pm.expect(foundNorwegian).to.be.true;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"messages\": [\n    {\"role\": \"user\", \"content\": \"Hva er den beste m√•ten √• kommunisere med en person som har demens?\"}\n  ],\n  \"temperature\": 0.7,\n  \"max_tokens\": 100,\n  \"stream\": false\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/chat",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"chat"
							]
						},
						"description": "Test non-streaming response format (fallback mode)"
					}
				},
				{
					"name": "Chat Error Handling - Empty Messages",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 422 or 400 (validation error)\", function () {",
									"    pm.expect([400, 422]).to.include(pm.response.code);",
									"});",
									"",
									"pm.test(\"Error indicates validation failure\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('detail');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"messages\": [],\n  \"temperature\": 0.7,\n  \"max_tokens\": 100,\n  \"stream\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/chat",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"chat"
							]
						},
						"description": "Test error handling for empty messages array"
					}
				}
			],
			"description": "Test NB-Llama Norwegian conversational AI with SSE streaming and medical boundaries"
		},
		{
			"name": "03. Direct Speech Processing",
			"item": [
				{
					"name": "Process Test Audio (Direct)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains direct transcription result\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData).to.have.property('processor_result');",
									"    pm.expect(jsonData).to.have.property('created_at');",
									"    pm.expect(jsonData).to.have.property('completed_at');",
									"});",
									"",
									"pm.test(\"Processor result is valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    const processor = jsonData.processor_result;",
									"    pm.expect(processor).to.have.property('processor');",
									"    pm.expect(processor.processor).to.include('nb-whisper');",
									"    pm.expect(processor).to.have.property('status');",
									"    pm.expect(processor).to.have.property('processing_time_ms');",
									"    pm.expect(processor.processing_time_ms).to.be.a('number');",
									"});",
									"",
									"pm.test(\"Metadata included\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('metadata');",
									"    pm.expect(jsonData).to.have.property('original_filename');",
									"});",
									"",
									"pm.test(\"Response time is direct (not queued)\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(30000); // 30 seconds max for direct processing",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "../test_audio.txt",
									"description": "Test audio file (text file for testing)"
								},
								{
									"key": "metadata",
									"value": "{\"environment\":\"quiet_home\",\"source\":\"postman_test\",\"device\":\"test_device\"}",
									"type": "text",
									"description": "Processing metadata"
								},
								{
									"key": "model_size",
									"value": "large",
									"type": "text",
									"description": "NB-Whisper model size (tiny/base/small/medium/large)"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/process/speech",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"process",
								"speech"
							]
						},
						"description": "Upload audio file for direct processing. Returns transcription immediately."
					}
				},
				{
					"name": "Process Norwegian Audio (Sample)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Norwegian transcription completed\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.status).to.be.oneOf(['completed', 'failed']);",
									"    pm.expect(jsonData.processor_result).to.have.property('processor');",
									"    pm.expect(jsonData.processor_result.processor).to.include('nb-whisper');",
									"    pm.expect(jsonData.processor_result.processor).to.include('large');",
									"});",
									"",
									"if (pm.response.json().status === 'completed') {",
									"    pm.test(\"Successful Norwegian transcription\", function () {",
									"        const jsonData = pm.response.json();",
									"        const result = jsonData.processor_result;",
									"        pm.expect(result).to.have.property('text');",
									"        pm.expect(result).to.have.property('language');",
									"        pm.expect(result.language).to.eql('no');",
									"        pm.expect(result).to.have.property('confidence_score');",
									"        pm.expect(result).to.have.property('segments');",
									"    });",
									"",
									"    pm.test(\"Quality metrics included\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property('quality_metrics');",
									"        pm.expect(jsonData.quality_metrics).to.have.property('audio_size_bytes');",
									"        pm.expect(jsonData.quality_metrics).to.have.property('processing_time_ms');",
									"        pm.expect(jsonData).to.have.property('duration_seconds');",
									"    });",
									"} else {",
									"    pm.test(\"Error handling for failed processing\", function () {",
									"        const jsonData = pm.response.json();",
									"        const result = jsonData.processor_result;",
									"        pm.expect(result).to.have.property('error');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "../samples/audio/eirik-str√∏m-2.m4a",
									"description": "Norwegian audio sample file"
								},
								{
									"key": "metadata",
									"value": "{\"environment\":\"test_lab\",\"source\":\"norwegian_sample\",\"device\":\"postman\"}",
									"type": "text"
								},
								{
									"key": "model_size",
									"value": "large",
									"type": "text",
									"description": "NB-Whisper model size (tiny/base/small/medium/large)"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/process/speech",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"process",
								"speech"
							]
						},
						"description": "Process actual Norwegian M4A audio file with NB-Whisper"
					}
				}
			],
			"description": "Direct speech processing tests (no job queues)"
		},
		{
			"name": "04. Error Handling",
			"item": [
				{
					"name": "Upload Without File",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400 or 422\", function () {",
									"    pm.expect([400, 422]).to.include(pm.response.code);",
									"});",
									"",
									"pm.test(\"Error indicates missing file\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('detail');",
									"    pm.expect(jsonData.detail.toLowerCase()).to.include('file');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "metadata",
									"value": "{\"environment\":\"test\"}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/process/speech",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"process",
								"speech"
							]
						},
						"description": "Test error handling when no file is uploaded"
					}
				},
				{
					"name": "Upload Empty File",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 with failed status or 400\", function () {",
									"    pm.expect([200, 400]).to.include(pm.response.code);",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    pm.test(\"Processing failed gracefully\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData.status).to.eql('failed');",
									"        pm.expect(jsonData.processor_result.status).to.eql('failed');",
									"        pm.expect(jsonData.processor_result).to.have.property('error');",
									"    });",
									"} else {",
									"    pm.test(\"Error indicates empty file\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property('detail');",
									"        pm.expect(jsonData.detail.toLowerCase()).to.include('empty');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "/dev/null",
									"description": "Empty file"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/process/speech",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"process",
								"speech"
							]
						},
						"description": "Test error handling for empty audio file"
					}
				},
				{
					"name": "Upload Large File",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 413 or 200 with graceful handling\", function () {",
									"    pm.expect([200, 413]).to.include(pm.response.code);",
									"});",
									"",
									"if (pm.response.code === 413) {",
									"    pm.test(\"File too large error\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(jsonData).to.have.property('detail');",
									"        pm.expect(jsonData.detail.toLowerCase()).to.include('large');",
									"    });",
									"} else {",
									"    pm.test(\"Large file processed or failed gracefully\", function () {",
									"        const jsonData = pm.response.json();",
									"        pm.expect(['completed', 'failed']).to.include(jsonData.status);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "../test_audio.txt",
									"description": "Test with size limit"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/process/speech",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"process",
								"speech"
							]
						},
						"description": "Test file size limit handling"
					}
				}
			],
			"description": "Test error scenarios and edge cases for direct processing"
		},
		{
			"name": "05. Performance Testing",
			"item": [
				{
					"name": "Direct Processing Performance",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response time reasonable for direct processing\", function () {",
									"    // Direct processing should be faster than old job queue system",
									"    pm.expect(pm.response.responseTime).to.be.below(10000);",
									"});",
									"",
									"pm.test(\"Processing completed with timing metrics\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('processor_result');",
									"    pm.expect(jsonData.processor_result).to.have.property('processing_time_ms');",
									"    pm.expect(jsonData.processor_result.processing_time_ms).to.be.a('number');",
									"    pm.expect(jsonData.processor_result.processing_time_ms).to.be.at.least(0);",
									"});",
									"",
									"pm.test(\"Memory efficient (single model instance)\", function () {",
									"    // Verify we're using the global model, not loading per request",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.processor_result.model_version).to.include('NbAiLab/nb-whisper');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "../test_audio.txt"
								},
								{
									"key": "metadata",
									"value": "{\"environment\":\"performance_test\",\"source\":\"direct_processing_test\"}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/process/speech",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"process",
								"speech"
							]
						},
						"description": "Test direct processing performance and memory efficiency"
					}
				}
			],
			"description": "Performance testing for direct processing architecture"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global pre-request script for direct processing",
					"console.log('Testing Direct Processing API:', pm.collectionVariables.get('base_url'));",
					"console.log('Architecture: Global NB-Whisper model with direct responses');"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global test script",
					"pm.test(\"Response should be JSON\", function () {",
					"    pm.response.to.be.json;",
					"});",
					"",
					"pm.test(\"Response time should be reasonable for direct processing\", function () {",
					"    // Direct processing has different timing characteristics than job queues",
					"    pm.expect(pm.response.responseTime).to.be.below(60000); // Max 1 minute for any audio",
					"});"
				]
			}
		}
	]
}