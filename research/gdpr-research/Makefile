# GDPR Research Project - Quick Commands

.PHONY: help setup run clean test install-ollama health

help:  ## Show this help
	@echo "GDPR Research Project - Available Commands:"
	@echo "=========================================="
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-15s\033[0m %s\n", $$1, $$2}'

setup:  ## Set up the project (install dependencies, create venv)
	@echo "ğŸ§ª Setting up GDPR Research Project..."
	@chmod +x setup.sh
	@./setup.sh

run:  ## Start the research server
	@echo "ğŸš€ Starting GDPR Research Server..."
	@chmod +x run.sh
	@./run.sh

clean:  ## Clean up virtual environment
	@echo "ğŸ§¹ Cleaning up..."
	@rm -rf venv
	@rm -rf __pycache__ app/__pycache__ app/**/__pycache__
	@echo "âœ… Cleaned up virtual environment and cache"

test:  ## Test the server (after it's running)
	@echo "ğŸ§ª Testing GDPR Research Server..."
	@echo "Health check:"
	@curl -s http://localhost:8000/health || echo "âŒ Server not running"
	@echo "\nCapabilities:"
	@curl -s http://localhost:8000/api/processors/capabilities | head -c 200 || echo "âŒ Server not running"
	@echo "..."

install-ollama:  ## Install Ollama and required model
	@echo "ğŸ¤– Installing Ollama and Norwegian model..."
	@if ! command -v ollama >/dev/null 2>&1; then \
		echo "Installing Ollama..."; \
		curl -fsSL https://ollama.ai/install.sh | sh; \
	else \
		echo "Ollama already installed"; \
	fi
	@echo "Pulling llama3.1:8b model..."
	@ollama pull llama3.1:8b
	@echo "âœ… Ollama setup complete"

health:  ## Check server health
	@curl -s http://localhost:8000/health | python3 -m json.tool 2>/dev/null || echo "âŒ Server not running"

# Quick development commands
dev: setup run  ## Setup and run in one command

# Installation verification
verify:  ## Verify installation works
	@echo "ğŸ” Verifying installation..."
	@if [[ -d "venv" ]]; then \
		echo "âœ… Virtual environment exists"; \
	else \
		echo "âŒ Virtual environment missing - run 'make setup'"; \
	fi
	@source venv/bin/activate && python3 -c "from app.main import app; print('âœ… Imports work')" 2>/dev/null || echo "âŒ Import test failed"